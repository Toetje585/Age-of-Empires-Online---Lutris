name: Age of Empires Online
game_slug: age-of-empires-online
version: Age of Empires Online - Project Celeste (Vulkan)
slug: age-of-empires-online-installer
runner: wine

script:
  game:
    appid: 105430
    exe: "$GAMEDIR/drive_c/Program Files/Age Of Empires Online/Celeste Launcher.exe"
    prefix: $GAMEDIR
    arch: win64
  
  files:
  - age_of_empires_online_installer: https://www.mediafire.com/file/afo6kcizm5qhl4e/AOEO_Installer.zip
  - age_of_empires_celeste_launcher: https://github.com/ProjectCeleste/Celeste.Launcher/releases/latest/download/CelesteLauncher.zip

  installer:
  - task:
      arch: win64
      description: "Creating 64Bit Wine prefix"
      name: create_prefix
      prefix: $GAMEDIR   
  - task:
      app: dotnet48
      description: "Installing .NET Framework. (4.8)"
      arch: win64
      name: winetricks
      prefix: $GAMEDIR    
  - extract:
      file: age_of_empires_online_installer
      dst: $GAMEDIR/setupdir/            
  - task:
      arch: win64
      description: Run the Age of Empires Online Installer
      executable: $GAMEDIR/setupdir/aoeo_setup.exe
      name: wineexec
      prefix: $GAMEDIR
  - extract:
      file: age_of_empires_celeste_launcher
      dst: "$GAMEDIR/drive_c/Program Files/Age Of Empires Online/"     
  system:
    env:
      DXVK_CONFIG_FILE: $GAMEDIR/dxvk.conf
      STAGING_SHARED_MEMORY: 1
      STAGING_WRITECOPY: 1
      WINE_LARGE_ADDRESS_AWARE: 1
    exclude_processes: "Celeste Launcher.exe" "Celeste Game Scanner UI.exe"
  wine:
    version: tbd     
